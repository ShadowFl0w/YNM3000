name: subdomain
desc: Scanning for subdomain

report:
  - "{{.Workspace}}/subdomain/sum-subdomain.txt"
  - "{{.Workspace}}/subdomain/new-subdomain.txt"


pre_run:
  - CreateFolder("{{.Workspace}}/subdomain/")

params:
  - subfinderThreads: "50"

steps:
  - required:
      - "{{.Binaries}}/subfinder"
      - "{{.Binaries}}/cleansub"
    commands:
      - "{{.Binaries}}/subfinder -d {{.Target}} -t {{.subfinderThreads}} -o {{.Workspace}}/subdomain/{{.Target}}-subfinder.txt"
  # cleaning some result
    scripts:
      #- Append("{{.Workspace}}/subdomain/sum-subdomain.txt", "{{.Workspace}}/subdomain/{{.Target}}-subfinder.txt")
      - ExecCmd("cat {{.Workspace}}/subdomain/{{.Target}}-subfinder.txt | {{.Binaries}}/cleansub -t '{{.Target}}' > {{.Workspace}}/subdomain/final-subdomain.txt")
      - ExecCmd("cat {{.Workspace}}/subdomain/final-subdomain.txt | {{.Binaries}}/anew {{.Workspace}}/subdomain/sum-subdomain.txt > {{.Workspace}}/subdomain/new-subdomain.txt")

last_run:
  # delete all files in workspaces folder except a file lists in report section
  - Cleaning("{{.Workspace}}/subdomain/")
